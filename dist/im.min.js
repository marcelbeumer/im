
(function(ns){var VERSION="post-1.2-dev";var prevNS=ns.im;var im=ns.im=function(selector,context){return new Chain(selector,context);};im.version=VERSION;im.noConflict=function(){ns.im=prevNS;return im;};im.browser=(function(){try{var userAgent=navigator.userAgent.toLowerCase();}catch(e){var userAgent='';}
return{version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!(/opera/.test(userAgent)),mozilla:/mozilla/.test(userAgent)&&!(/(compatible|webkit)/.test(userAgent))};})();im.isFunction=function(obj){return Object.prototype.toString.call(obj)==="[object Function]";};im.isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]";};im.isString=function(obj){return Object.prototype.toString.call(obj)==="[object String]";};im.isObject=function(obj){return Object.prototype.toString.call(obj)==="[object Object]";};im.merge=function(first,second){var i=first.length,j=0;if(typeof second.length==="number"){for(var l=second.length;j<l;j++){first[i++]=second[j];}}else{while(second[j]!==undefined){first[i++]=second[j++];}}
first.length=i;return first;};im.extend=function(firstObj,secondObj){for(var name in secondObj){if(secondObj.hasOwnProperty(name))firstObj[name]=secondObj[name];}
return firstObj;};var rtrim=/^(\s|\u00A0)+|(\s|\u00A0)+$/g;im.trim=function(str){return(str||"").replace(rtrim,"");};im.proxy=function(fn,scope){return function(){return fn.apply(scope,arguments);};};im.chains={};var Chain=function(selector,context){this.length=0;if(!selector){}else if(selector.nodeType){this.length=1;this[0]=selector;}else if(im.isString(selector)){if(selector.match('<.*>')){if(!im.create)throw new Error("Chain: no create implementation loaded");var el=im.create(selector);if(!el)return this;this.length=1;this[0]=el;}else{if(!im.selectNodes)throw new Error("Chain: no selectNodes implementation loaded");im.merge(this,im.selectNodes(selector,context));}}else if(im.isFunction(selector)){if(!im.onready)throw new Error("Chain: no onready implementation loaded");im.onready(selector);}else if(selector.length!==undefined){im.merge(this,selector);}else{this.length=1;this[0]=selector;}
return this;};Chain.prototype=im.chains;var pushStack=function(obj,selector){var n=im(selector);n.__prev=obj;return n;};im.chains.reset=function(selector){return pushStack(this,selector);};im.chains.end=function(){return this.__prev||im();};im.chains.exec=function(fn){fn.apply(this);return this;};im.chains.array=function(){var a=[];im.merge(a,this);return a;};im.chains.item=function(number){number=number||0;if(this.length>number&&this[number])return this.reset(this[number]);return this.reset();};im.chains.el=function(number){number=number||0;if(this.length>number&&this[number])return this[number];};im.each=function(obj,callback){var length=obj.length;var isObject=length===undefined||im.isFunction(obj);if(isObject){var name;for(name in obj){if(callback.call(obj[name],name,obj[name])===false)break;}}else{var i=0;for(var value=obj[0];i<length&&callback.call(value,i,value)!==false;value=obj[++i]){}}};im.chains.each=function(callback){im.each(this,callback);return this;};})(window);(function(im){im.getAncestors=function(element,resultArr){var a=resultArr||[];var p=element.parentNode;while(p){a.push(p);p=p.parentNode;}
return a;};im.getAncestorOrSelf=function(nodeOrClassName,element){var match=false;if(nodeOrClassName.indexOf('.')==0){if(im.hasClass(element.className,nodeOrClassName.substr(1)))match=true;}else{if(nodeOrClassName==element.nodeName.toLowerCase())match=true;}
if(!match){if(element.parentNode){return im.getAncestorOrSelf(nodeOrClassName,element.parentNode);}else{return null;}}else{return element;}};im.isAncestorOf=function(ancestor,child){return ancestor.contains?ancestor!=child&&ancestor.contains(child):!!(ancestor.compareDocumentPosition(child)&16);};im.getFirstChildElement=function(node){var child=node.firstChild;while(child&&child.nodeType!=1){child=child.nextSibling;}
return child;};im.getChildElements=function(node){var children=[];var child=node.firstChild;for(;child;child=child.nextSibling){if(child.nodeType==1)children.push(child);}
return children;};im.hasClass=function(strOrElement,className){if(!strOrElement)return false;if(!im.isString(strOrElement))strOrElement=strOrElement.className;var r=new RegExp("(^|\\s)"+className+"(\\s|$)");return r.test(strOrElement);};im.chains.hasClass=function(className){if(this.length>0)return im.hasClass(this[0],className);};im.addClass=function(element,className){if(im.hasClass(element.className,className))return;element.className=element.className+' '+className;};im.chains.addClass=function(className){for(var x=0;x<this.length;x++)im.addClass(this[x],className);return this;};im.removeClass=function(element,className){var classes=(element.className+'').split(' ');var n=[];var l=classes.length;for(var x=0;x<l;x++){var c=classes[x];if(c!=className)n.push(c);}
element.className=n.join(' ');};im.chains.removeClass=function(className){for(var x=0;x<this.length;x++)im.removeClass(this[x],className);return this;};im.toggle=function(element,className){if(className){if(im.hasClass(element,className)){im.removeClass(element,className);}else{im.addClass(element,className);}}else{var visible=element.style.display!='none';if(visible){im.hide(element);}else{im.show(element);}}};im.chains.toggle=function(className){for(var x=0;x<this.length;x++)im.toggle(this[x],className);return this;};var uuidRef='_uuidRef'+(+new Date());var uuid=0;var elementData=[];im.getUUID=function(element,doNotCreateUUID){if(!element[uuidRef])element[uuidRef]=++uuid;return element[uuidRef];};im.hasUUID=function(element,uuid){if(element[uuidRef]&&(!uuid||element[uuidRef]==uuid))return true;return false;};im.getElementByUUID=function(uuid,context,nodeName){var nodes=(context||document).getElementsByTagName(nodeName||'*');var len=nodes.length;for(var x=0;x<len;x++){var node=nodes[x];if(node[uuidRef]&&node[uuidRef]==uuid)return node;}
return null;};im.data=function(element,key,value){if(arguments.length==0)return elementData;if(!element)return;var uuid=im.getUUID(element);var d=elementData[uuid]=elementData[uuid]||{};if(!key){return d;}else if(value){d[key]=value;}else{return d[key];}};im.chains.data=function(key,value){if(value){for(var x=0;x<this.length;x++){im.data(this[x],key,value);}
return this;}else{if(this[0])return im.data(this[0],key,value);}};im.show=function(element){if(!element)return;var olddisplay=im.data(element,'olddisplay')||'block';element.style.display=olddisplay;return element;};im.chains.show=function(){for(var x=0;x<this.length;x++)im.show(this[x]);return this;};im.hide=function(element){if(!element)return;var display=element.style.display;if(display!='none'){im.data(element,'olddisplay',element.style.display);}
element.style.display='none';return element;};im.chains.hide=function(){for(var x=0;x<this.length;x++)im.hide(this[x]);return this;};im.remove=function(element){element.parentNode.removeChild(element);};im.chains.remove=function(){for(var x=0;x<this.length;x++)im.remove(this[x]);return this;};im.appendTo=function(element,appendTo){im(appendTo).el(0).appendChild(element);};im.chains.appendTo=function(appendTo){a=im(appendTo);for(var x=0;x<this.length;x++)im.appendTo(this[x],a);return this;};im.append=function(element,append){var e=im(append);for(var x=0;x<e.length;x++)element.appendChild(e[x]);};im.chains.append=function(append){for(var x=0;x<this.length;x++)im.append(this[x],append);return this;};im.html=function(element,value){if(value||value=='')element.innerHTML=value;else return im.trim(element.innerHTML);};im.chains.html=function(value){if(value||value==''){for(var x=0;x<this.length;x++)im.html(this[x],value);return this;}else{if(this.length>0)return im.html(this[0]);}};im.create=function(html){var div=document.createElement('div');div.innerHTML=im.trim(html);return div.firstChild;};im.attr=function(el,name,value){if(value)el.setAttribute(name,value);else return el.getAttribute(name);};im.chains.attr=function(name,value){if(value){for(var x=0;x<this.length;x++)im.attr(this[x],name,value);return this;}else{if(this.length>0)return im.attr(this[0],name);}};im.removeAttr=function(el,name){el.removeAttribute(name);};im.chains.removeAttr=function(name){for(var x=0;x<this.length;x++)im.removeAttr(this[x],name);return this;};})(window.im||window);(function(im){var store=function(element,bucket,obj){var d=im.data(element,bucket)||[];d.push(obj);im.data(element,bucket,d);};var unbind=function(element,bucket,options){var d=im.data(element,bucket)||[];var l=d.length;while(l--){var i=d[l];if(i&&i.unbind){var matches=true;for(var name in options){if(options[name]&&(options[name]!=i[name])){matches=false;break;}}
if(matches){i.unbind();d.splice(l,1);}}}
im.data(element,bucket,d);};im.bind=function(element,name,handler){var types=im.bind.types;var impl=(types[name]||types['default'])();var unbind=impl.bind(element,name,handler);store(element,'__binds__',{name:name,fn:handler,unbind:unbind});};im.chains.bind=function(eventName,handler){for(var x=0;x<this.length;x++)im.bind(this[x],eventName,handler);return this;};im.unbind=function(element,name,handler){unbind(element,'__binds__',{name:name,fn:handler});};im.chains.unbind=function(eventName,handler){for(var x=0;x<this.length;x++)im.unbind(this[x],eventName,handler);return this;};im.live=function(element,selector,name,handler){var types=im.bind.types;var impl=(types[name]||types['default'])();if(!im.isFunction(impl.live))return;var unbind=impl.live(element,selector,name,handler);store(element,'__lives__',{selector:selector,name:name,fn:handler,unbind:unbind});};im.chains.live=function(selector,eventName,handler){for(var x=0;x<this.length;x++)im.live(this[x],selector,eventName,handler);return this;};im.die=function(element,selector,name,handler){unbind(element,'__lives__',{selector:selector,name:name,fn:handler});};im.chains.die=function(selector,eventName,handler){for(var x=0;x<this.length;x++)im.die(this[x],selector,eventName,handler);return this;};im.bind.types={};im.bind.types['default']=function(){var self={};self.getEventObject=function(e,element){e=e||window.event;if(!e.target)e.target=e.srcElement||document;if(!e.currentTarget)e.currentTarget=element;if(e.target.nodeType===3)event.target=event.target.parentNode;if(!e.preventDefault)e.preventDefault=function(){e.returnValue=false;};if(!e.stopPropagation)e.stopPropagation=function(){e.cancelBubble=true;};return e;};self.addEventListener=function(element,name,handler){if(window.addEventListener){element.addEventListener(name,handler,false);}else{element.attachEvent('on'+name,handler);}};self.removeEventListener=function(element,name,handler){if(window.removeEventListener){element.removeEventListener(name,handler,false);}else{element.detachEvent('on'+name,handler);}};self.returnValue=function(e,returnValue){if(returnValue!==false)return;e.preventDefault();e.stopPropagation();return false;};self.elementWithinSelector=function(element,selector){var el,t=im(element);if(t.filter(selector).length>0){el=element;}else{var inv=t.parents(selector);if(inv.length>0)el=inv[0];}
return el;};self.bind=function(element,name,handler){var that=self;var h=function(e){e=that.getEventObject(e,element);var r=handler.apply(element,[e]);return that.returnValue(e,r);};self.addEventListener(element,name,h);return function(){that.removeEventListener(element,name,h);};};self.live=function(element,selector,name,handler){var that=self;return self.bind(element,name,function(e){var el=that.elementWithinSelector(e.target,selector);if(el)return handler.apply(el,[e]);});};return self;};var mouseEnterLeave=function(name){var self=im.bind.types['default']();var realName=name=='mouseenter'?'mouseover':'mouseout';var validate=function(element,name,e){var related=e.relatedTarget?e.relatedTarget:(name=="mouseleave"?e.toElement:e.fromElement);if(related&&(related==element||im.isAncestorOf(element,related)))return false;return true;};var __super__bind=self.bind;self.bind=function(element,name,handler){return __super__bind(element,realName,function(e){if(!validate(element,name,e))return;return handler.apply(element,[e]);});};self.live=function(element,selector,name,handler){var ews=self.elementWithinSelector;return __super__bind(element,realName,function(e){var el=ews(e.target,selector);if(el&&validate(el,name,e))return handler.apply(el,[e]);});};return self;};im.bind.types.mouseenter=function(){return im.browser.msie?im.bind.types['default']():mouseEnterLeave('mouseenter');};im.bind.types.mouseleave=function(){return im.browser.msie?im.bind.types['default']():mouseEnterLeave('mouseleave');};})(window.im||window);(function(im){var readyHandlers=[];var readyBound=false;var isReady=false;var ready=function(){if(isReady)return;isReady=true;var l=readyHandlers.length;for(var x=0;x<l;x++){readyHandlers[x]();}};var bindReady=function(){if(readyBound)return;readyBound=true;if(document.addEventListener&&!im.browser.opera){document.addEventListener("DOMContentLoaded",ready,false);}
if(im.browser.msie&&window==top)(function(){if(isReady)return;try{document.documentElement.doScroll("left");}catch(e){setTimeout(arguments.callee,0);return;}
ready();})();if(im.browser.opera){document.addEventListener("DOMContentLoaded",function(){if(isReady)return;for(var i=0;i<document.styleSheets.length;i++){if(document.styleSheets[i].disabled){setTimeout(arguments.callee,0);return;}}
ready();},false);}
im.bind(window,'load',ready);};im.onready=function(handler){readyHandlers.push(handler);bindReady();};im.onload=function(handler){im.bind(window,'load',handler);};})(window.im);(function(im){var colorTypes=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,convert:function(bits){return[parseInt(bits[1],10),parseInt(bits[2],10),parseInt(bits[3],10)];}},{re:/^#(\w{2})(\w{2})(\w{2})$/,convert:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)];}},{re:/^#(\w{1})(\w{1})(\w{1})$/,convert:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)];}}];var colorCache={};var interpolate=function(source,target,pos){return(source+(target-source)*pos).toFixed(3);};var getColor=function(color){var c,l=colorTypes.length;while(l--){var m=colorTypes[l].re.exec(color);if(m){c=colorTypes[l].convert(m);break;}}
return c;};var calculateColor=function(source,target,pos){var sc=colorCache[source]=colorCache[source]||getColor(source);var tc=colorCache[target]=colorCache[target]||getColor(target);var c=3,r=[];while(c--)r[c]=parseInt(sc[c]+((tc[c]-sc[c])*pos),10);return'rgb('+r.join(',')+')';};var parseRule=function(value,old){var number=parseFloat(value);var postfix=(value+'').replace(/^[\-\d\.]+/,'');if(isNaN(number)){return{value:value,postfix:'',method:calculateColor};}else{return{value:number,postfix:postfix,method:interpolate};}};im.css=function(element,nameOrObject){if(im.isString(nameOrObject)){var c=element.currentStyle?element.currentStyle:getComputedStyle(element,null);if(im.browser.msie&&nameOrObject=="opacity"){var match=(element.currentStyle.filter+'').match(/alpha\(opacity=(\d+)/);return((match&&match.length>1)?(parseInt(match[1],10)/100):1)+'';}else{return c[nameOrObject];}}else{for(var n in nameOrObject){var s=element.style;if(im.browser.msie&&n=='opacity'){if(!element.currentStyle.hasLayout)s.zoom=1;var v=parseFloat(nameOrObject[n]);if(v==1){s.removeAttribute('filter');}else{s.filter='alpha(opacity='+Math.round(v*100)+')';}}else{s[n]=nameOrObject[n];}}}};im.chains.css=function(nameOrObject){if(im.isString(nameOrObject)){if(this.length>0)return im.css(this[0],nameOrObject);}else{for(var x=0;x<this.length;x++)im.css(this[x],nameOrObject);return this;}};im.animate=function(el,obj,speed,callback,easing,customHandler){var job={current:{},target:{},obj:obj,el:el,dur:speed?speed:300,easing:easing||function(pos){return(-Math.cos(pos*Math.PI)/2)+0.5;},callback:callback,customHandler:customHandler};if(el&&obj){for(var prop in obj){var currentValue=im.css(el,prop);if(currentValue=='auto')currentValue='0';job.current[prop]=parseRule(currentValue);job.target[prop]=parseRule(obj[prop]+'',currentValue);}}
im.animate.clock.add(job);};im.animate.clock=(function(){var self={};var interval;self.jobs=[];self.render=function(job,time,position){var j=job;var finish=j.finish,start=j.start,dur=j.dur,el=j.el,obj=j.obj,easing=j.easing;var current=j.current,target=j.target;var pos=position===undefined?(time>=finish?1:(time-start)/dur):position;if(el&&obj){var v,now={};for(var prop in obj){v=target[prop].method(current[prop].value,target[prop].value,easing(pos))+target[prop].postfix;now[prop]=v;}
im.css(el,now);}
if(j.customHandler)j.customHandler.apply(el||window,[easing(pos)]);if(pos===1&&j.callback)j.callback.apply(el);return pos===1;};self.tick=function(){var time=+new Date,r=self.render,l=self.jobs.length;while(l--){if(r(self.jobs[l],time))self.jobs.splice(l,1);}
if(self.jobs.length==0)self.stop();};self.start=function(){interval=setInterval(self.tick,20);};self.stop=function(){if(interval)interval=clearInterval(interval);};self.remove=function(i,end){if(!self.jobs[i])return;var job=self.jobs.splice(i,1)[0];if(end)self.render(job,0,1);};self.add=function(job){self.jobs.push(job);job.start=+new Date;job.finish=job.start+job.dur;if(!interval)self.start();};return self;})();im.chains.animate=function(obj,speed,callback,easing,customHandler){for(var x=0;x<this.length;x++)im.animate(this[x],obj,speed,callback,easing,customHandler);return this;};im.stop=function(el,end){var jobs=im.animate.clock.jobs;var l=jobs.length;while(l--){if(jobs[l].el===el)im.animate.clock.remove(l,end);}};im.chains.stop=function(end){for(var x=0;x<this.length;x++)im.stop(this[x],end);return this;};im.offset=function(el){var l=0,t=0;while(el){l+=el.offsetLeft;t+=el.offsetTop;el=el.offsetParent;}
return{left:l,top:t};};im.chains.offset=function(){if(this.length>0)return im.offset(this[0]);};var getScrollbarWidth=(function(){var scrollbarWidth=0;return function(){if(!scrollbarWidth){var testEl=im('<div>').css({width:100,height:100,overflow:'auto',position:'absolute',top:-1000,left:-1000}).appendTo('body');scrollbarWidth=100-testEl.append('<div></div>').find('div').css({width:'100%',height:200}).width();testEl.remove();}
return scrollbarWidth;};})();var getMargin=function(el,dir){var v=parseInt(im.css(el,'margin'+dir),10);if(isNaN(v))v=0;return v;};var getSize=function(el,axis,options){options=options||{};if(el===window||el===document){var windowSize,documentSize;var opp=axis=='Width'?'Height':'Width',bodyClientOpp=document.body['client'+opp],bodyScrollOpp=document.body['scroll'+opp],windowInnerCur=window['inner'+axis],docElClientCur=document.documentElement['client'+axis],bodyClientCur=document.body['client'+axis],bodyScrollCur=document.body['scroll'+axis];if(!im.browser.msie){windowSize=windowInnerCur;var sb=options.includeScrollbar?0:getScrollbarWidth();if(bodyClientOpp<bodyScrollOpp)windowSize=windowSize-sb;}else{windowSize=docElClientCur||bodyClientCur;}
if(windowSize>=bodyScrollCur)documentSize=windowSize;else documentSize=bodyScrollCur;if(el===window){return windowSize;}else if(el===document){return documentSize;}}
var size=el['offset'+axis];if(options.includeMargins===true){var gm=getMargin;if(axis==='Width'){size+=gm(el,'Left');size+=gm(el,'Right');}else{size+=gm(el,'Top');size+=gm(el,'Bottom');}}
return size;};im.width=function(el,options){return getSize(el,'Width',options);};im.chains.width=function(options){if(this.length>0)return im.width(this[0],options);};im.height=function(el,options){return getSize(el,'Height',options);};im.chains.height=function(options){if(this.length>0)return im.height(this[0],options);};})(window.im||window);(function(im){var AXISALL=0;var AXISCHILD=1;var bitCache={};var resultCache={};var parseSelector=function(selector){var joins=selector.split(',');var jl=joins.length;while(jl--){joins[jl]=joins[jl].split(' ');}
return joins;};var hasClasses=function(className,regex){var l=regex.length;while(l--){if(!regex[l].test(className))return false;}
return true;};var makeHasClassesRegexes=function(classes){var r=[];var l=classes.length;while(l--){r.push(new RegExp("(^|\\s)"+classes[l]+"(\\s|$)"));}
return r;};var parseSelectionBit=function(bit){var parts=bit.split('.');var nodeName=parts.shift();var remains=!!(parts.length>0);return{nodeName:nodeName==''?'*':nodeName.toUpperCase(),classNames:remains?parts:null,classNamesRegexes:remains?makeHasClassesRegexes(parts):null};};var getContexts=function(currentContexts,axis,selection){var result=[];var nodeName=selection.nodeName;var classNames=selection.classNames;var regex=selection.classNamesRegexes;var _hasClasses=hasClasses;var cl=currentContexts.length;if(axis==AXISCHILD){for(var x=0;x<cl;x++){var context=currentContexts[x];var n=context.firstChild;for(;n;n=n.nextSibling){if(n.nodeType==1&&(nodeName=='*'||nodeName==n.nodeName)){if(classNames){var c=n.className;if(!c)continue;if(_hasClasses(c,regex))result.push(n);}else{result.push(n);}}}}}else{for(var x=0;x<cl;x++){var context=currentContexts[x];var nodes=context.getElementsByTagName(nodeName);var l=nodes.length;for(var y=0;y<l;y++){if(classNames){var n=nodes[y],c=n.className;if(!c)continue;if(_hasClasses(c,regex))result.push(n);}else{result.push(nodes[y]);}}}}
return result;};var filterUniqueNodes=function(nodes){var duplicate=false;var sort=(function(){if(document.documentElement.compareDocumentPosition){return function(a,b){var r=a.compareDocumentPosition(b)&4?-1:a===b?0:1;if(r==0)duplicate=true;return r;};}else if("sourceIndex"in document.documentElement){return function(a,b){var r=a.sourceIndex-b.sourceIndex;if(r==0)duplicate=true;return r;};}})();nodes.sort(sort);if(duplicate){var l=nodes.length;for(var x=1;x<l;x++){if(nodes[x]==nodes[x-1]){nodes.splice(x--,1);l--;}}}
return nodes;};var getCacheResultKey=function(context,selector){var k='',l=context.length;while(l--)k+=im.getUUID(context[l])+':';return k+selector;};var getResultCache=function(context,selector){var key=getCacheResultKey(context,selector);return resultCache[key];};var addResultCache=function(context,selector,result){var key=getCacheResultKey(context,selector);resultCache[key]=result;};var cleanSelector=function(selector){return im.trim(selector.replace(/>/g,' > ').replace(/\s+/g,' '));};im.selectNodes=function(selector,context,resultArr){var contexts=context?(context.length?context:[context]):[document];var cache=selector.match(/^(%[\?\!]?)(.*)/);selector=cleanSelector(cache?cache[2]:selector);if(cache&&cache[1]!='%!'){var r=getResultCache(contexts,selector);if(r||cache[1]=='%?')return r||[];}
var parsed=parseSelector(selector);var results;var axis=AXISALL;var pl=parsed.length;for(var x=0;x<pl;x++){var currentContexts=[].concat(contexts);var psel=parsed[x];var bl=psel.length;for(var y=0;y<bl;y++){if(currentContexts.length==0)break;var bit=psel[y];if(bit==''){}else if(bit=='>'){axis=AXISCHILD;}else if(/^#/.test(bit)){var el=document.getElementById(bit.substring(1,bit.length));currentContexts=el?[el]:[];axis=AXISALL;}else{if(!bitCache[bit])bitCache[bit]=parseSelectionBit(bit);currentContexts=getContexts(currentContexts,axis,bitCache[bit]);axis=AXISALL;}}
results=(x==0)?currentContexts:results.concat(currentContexts);results=filterUniqueNodes(results);};if(cache)addResultCache(contexts,selector,results);if(resultArr){results=filterUniqueNodes(results.concat(resultArr));resultArr.splice(0,resultArr.length);var l=results.length;for(var x=0;x<l;x++)resultArr.push(results[x]);}
return results;};im.chains.find=function(selector){if(this.length==0)return this;return this.reset(im.selectNodes(selector,this.array()));};im.chains.parents=function(selector){var results=[];if(!selector||selector=='*'){for(var x=0;x<this.length;x++)im.getAncestors(this[x],results);if(this.length>1)results=filterUniqueNodes(results);}else{var s=im.selectNodes(selector);var l=s.length;var iao=im.isAncestorOf;for(var x=0;x<l;x++){var si=s[x];for(var y=0;y<this.length;y++){if(iao(si,this[y])){results.push(si);break;}}}
results.reverse();}
return this.reset(results);};im.chains.parent=function(){var results=[];for(var x=0;x<this.length;x++){var p=this[x].parentNode;if(p)results.push(p);}
if(this.length>1)results=filterUniqueNodes(results);return this.reset(results);};im.chains.filter=function(selector,invert){var results=[];if(im.isFunction(selector)){for(var x=0;x<this.length;x++){var m=selector.apply(this[x],[x]);if((!invert&&m)||(invert&&!m))results.push(this[x]);}}else{var s=im.selectNodes(selector||'*');var l=s.length;for(var x=0;x<this.length;x++){for(var y=0;y<l;y++){var m=s[y]===this[x];if((!invert&&m)||(invert&&!m)){results.push(this[x]);break;}}}}
return this.reset(results);};})(window.im||window);(function(ns){var STOP_CLASSNAME='scan-stop';var bitCache={};var registry={};var rtrim=/^(\s|\u00A0)+|(\s|\u00A0)+$/g;var trim=function(str){return(str||"").replace(rtrim,"");};var hasClass=function(node,className){var cn=node.className;var r=new RegExp("(^|\\s)"+className+"(\\s|$)");return r.test(cn);};var hasClasses=function(className,classes,regex){var l=classes.length;while(l--){if(!regex[l].test(className))return false;}
return true;};var makeHasClassesRegexes=function(classes){var r=[];var l=classes.length;while(l--){r.push(new RegExp("(^|\\s)"+classes[l]+"(\\s|$)"));}
return r;};var runTriggers=function(node,parsed){var nn=node.nodeName.toLowerCase();var cn=node.className;var result=true;var sell=parsed.length;for(var seli=0;seli<sell;seli++){var nnMatch=false;var cnMatch=false;var sel=parsed[seli][0];var f=parsed[seli][1];var joinsl=sel.length;while(joinsl--&&(!cnMatch||!nnMatch)){var join=sel[joinsl];if(join.nodeName=='*'||join.nodeName==nn)nnMatch=true;if(join.classNames&&join.classNames.length>0){if(cn&&hasClasses(cn,join.classNames,join.classNamesRegexes))cnMatch=true;}else{cnMatch=true;}}
if(cnMatch&&nnMatch){var r=f.apply(node);result=r===false?r:(r===true?r:result);}}
return result;};var walk=function(node,parsed){if(hasClass(node,STOP_CLASSNAME))return;var result=runTriggers(node,parsed);if(result===false)return;var len=0;var children=[];var child=node.firstChild;for(;child;child=child.nextSibling){if(child.nodeType==1){children.push(child);len++;}}
for(var x=0;x<len;x++){walk(children[x],parsed);}};var parseSelectionBit=function(bit){var parts=bit.split('.');var nodeName=parts.shift();var classNames=parts;return{nodeName:nodeName==''?'*':nodeName,classNames:classNames,classNamesRegexes:makeHasClassesRegexes(classNames)};};var parseSelector=function(selector){var joins=selector.split(',');var jl=joins.length;while(jl--){var bit=trim(joins[jl]);joins[jl]=bitCache[bit]=bitCache[bit]||parseSelectionBit(bit);}
return joins;};var parseTriggers=function(triggers){var parsed=[];var l=triggers.length;for(var x=0;x<l;x++){var t=triggers[x];var p=parseSelector(t[0]);var f=t[1];parsed.push([p,f]);}
return parsed;};ns.scan=function(){var l=arguments.length,t=[],nodes=[],str=Object.prototype.toString;while(l--){var a=arguments[l];if(str.call(a)=='[object String]'){t=t.concat(registry[a]||[]);}else if(str.call(a)=='[object Array]'){t=t.concat(a);}else if(a.nodeType){nodes.push(a);}}
if(t.length==0)return;t=parseTriggers(t);if(nodes.length==0)nodes.push(document.body);var nl=nodes.length;while(nl--){walk(nodes[nl],t);}};ns.scan.register=function(){var type,selector,fn,l=arguments.length;if(l<3)throw new Error('scan.register takes at least three parameters');selector=arguments[l-2];fn=arguments[l-1];for(var x=0;x<l-2;x++){var a=arguments[x];var r=registry[a]=registry[a]||[];r.push([selector,fn]);}};ns.scan.registry=registry;})(window.im||window);